import { TextDecoder } from 'util'
import { parseSporeCellData, parseSporeClusterData } from '../../utils/spore'

// from existed transfer spore cell transaction: https://pudge.explorer.nervos.org/transaction/0x88be3c6ad1ca06dbecda108b539d288cfb134bdf4b65d7a14661a5f3bd045600
const sporeCellData =
  '0xe80f0000100000001e000000c40f00000a000000696d6167652f77656270a20f0000524946469a0f000057454250565038208e0f0000f093009d012af40179033e9148a14ca5a423a220b37830b01209696ee177611fdd5d8d9e23e47f61f477b2bf8cfa63e41f313d8e7f57fc2fe607ce0ff87eaf7cc1bf5aba79f9a2fb60f742ff8ffb55efcbfb87a97ff53ff87d74de8bbe5c3ed2bfba5e9199cc1d7e7fb4e91af894bd9bfad4a7b5bcfef687c021e3f6817747cfa267caf7d023c5bf4cbf5d7a3a82093264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c993264c9937c576e7310bc993264c993264c99321abc0f7dc5dcea64c993264c993264c992cb00461e960075816f26376b0a40cb264c993264c993259679146f1b6bbaa281da07ad9f92661f3c365eae1c74dd5fd12cf3b3720ad36c1309b24d9b366cd9b366ced702977891486c8549ac9311be75400f15395915f0f8015d467fe0d03ac4cbb50d2529494a66d01b4be46fff17ae74fb74ff613ac993264c993264c9bfb851d938d29f4e65dfd5d67fa8a21dbc133b965bde881b6b8ff80014ddc0f295484fa6ec0da86f5d51ac363fab77d24d9b366cd9b366d2bab72642ba9ed77decbea69282dbd2343861ea4a868b5271f79c3e1b32722c43590e12593264c993264c9a66e3f7dcdf51a8aa883183eb5aa1502b76002c6fe694cf10204081020408106c2b468c05dbc8da26c5c01b238be5d655fb385f8fd2a3addfdd94ec7eab5d3e60c183060c183060c1678a3bf4a843b054c2a820709160e43807fee66d5e0a7cc8f38f2aa365b1e31f853060c183060c183060c1faeeecbf7af53706c58ae9942d48bbacbc75993264c993264c993264b334b55bfcb5770e882c5c5651a95772ed8f2a4f727d86593264c993264c993265367ee960c0c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c183060c18306020000feffbbfffed3349793bfe62eb886f5d06615c03397000000000000000000000000000000000000197bb417b920bd052626684a7c0a563e2db21e937b3cf8ea8db42dd018aefca15e02d299fca50ef632e933fafe540877cb265edaa3054b0e9ba49a5d255410e2fb84f804d27e0adf3941ee62bc604fe7bed44667ef2c7a41909a3606c8930f19c86b09f7f590b8ac324eeffa036341dcf5d4379370c07ef1b89c018ca23ff823bb0c8ff861bee056f275435a00609e4109b1dbe6403f86db242737be04ebbf578b35b9243b473fd55fed22d13537b7f4b4f9585e7d261497605a2c92f3148ca10cd7d0018a67681593711f11465da834bdd4ce68b4d2cfa3f961ba42ac90257fd5e6e5c32e245b133032575226a2abe61234cb120b8cbe83afd5df43f13c7e77e216b8dcdb7166067c4b9d7c61df829e8ff92d533ec78281d79a6b43200d2b40ca34a13a0f6841356483b3216531cb938080c9376083e57ab34eda445b13e514fcd55d93162bb95b57068feeed23e6e43b573a8626719f6172233040f389202c87d0188579d354ca8e3d49795c8f99019e81f1c5d153436cf7eab342bf4b1f6912647ae2a4ffd4bd19e280c0f375d0eae2357e9508a6f0cb90b139253300e5d2aeaf6a58883b669ed1622b33838678beb70c3175d44094094cfa77b5a0678fd8fdcbf3555a8410f5a1f79acffd7b6757bc722dd1e24204fefb40be730bc9dae88a1872a9c625dc262e0764921c70496e2b5e4d3e56c7d0b0b61ec6ff649896afbb0041530ae6f66a289c9ede4a9ecb823cf59f2812a78158906c2098ac7369fabe0ce4c693cc30514e674a1839f2538c7ff7bb5df7425ee5d81540c0063f7a3a003eb4b09ba96a8f175bcaa5a0e950def71f500a75b3705e8ee8ceb5620929971e1e858519e8daf4f13939382db96a3950534558f3e821e22f9108b73983466048b5e2b0eb36f4e268859135043f6abd9d9af5601432588f5f6ed400360df300ab445ff2b872624b38b137ba5ff36e18e47c3ab36021a74c528ea5d796d19af6b4150ac4145281df5a05eba81c58eec056ab91e64bf6e572f5c142935cf0067a5ef004bcf3239ad63712d02812f62ea00aeb6aee05593fba2924fdda809bdc9c25bfc19390b091ff3229ca9c6627e85634a4f3fb8f645d5e3b9c888648d764b6d73360721b2007a58f3a7e21cf766d21391a93afbc5e6d6431b6c9028c23ee87a08eb656784c0df6dcef937e5971b976f3dbcffbb6c95dca4fe921102e762002de1bdf655c31ec23fa1d12be397f1fa4f3309004e942a68b776a24878eda9ec6f1e9c9f02adc13663a8f30ff9646a1927f7b91eec2e22e984c6b5bee221ffc81df11431f85737b1ff253fa6b87278aac3f0d6419bac8a65ffeff3dfef94e91f12dd7ba62108def41ca194cfea5b88778f794557edd5372160006711107209182a2cce058731d2d130bb684d9c8c686c1d0678bbcf92ed2930bee90d0e9f2b31cf83749d39e2ed38a133e500521346dd1a424b71c77c7615a705d2b8a176f0711c25778081737829000e5a200887a98cba68f45d136e837e7c98eecc892e7b09458e9c67f98dab2d8503cbf019c694323f434ae7a65dba680e6efccff4e55f2095e222ceeeb543ed2adf8a2d847fa15543c8569496eaf01f622bf8c63a74d9f4c9da4d98464c3f0644f51e620af81a8cca480374b351aa81ae6d9045ef8ab1866e41db05ee63cc6930a86fbdf4b06fa0b56159e093ce657ec92802bf329c580ef0b32fafffe172abbd2abc6b4e6e85d3bc1e35f58fddd2441d9ae41c191322936c0b718f4c904a974b3b9804e08bf775f4320c89142386e57df3cb5726481ff31eb883bd38a8b925e590bb6ec7174000d8c3fe46dcbbed1e5d4f349dc0c0a8f6f1e5436190a297d886819d9cd9b4ba8ee89271c101af7b2bccd2d0cf7bd7added14e8d8564c79f6dbaec9335be745e8696cf8ceddee5fecfcb999336c6c62e37905e1b36fddfef3c56c71d3f2536bfb4af9f18e8ff1c9454cd23985f7e4f61d187f5975b961acd59427938687c4c49171daa3024b21fb21e61249ccda1d82ae47a15e08ac262322df9fc3578dedf45d4e8c82227ec25e7e91655e715f6a559e29e52e8142f4a7639f9726c2188371f2679ec4d5d8e190d6f36459f6727a0b761220309db15f66f3f0a97ff05c3fefcbef7b84b90a1f78fe8bae390b9176e500ffae04c13874d134299b3db846eb567e4d25f7901b50f8efa163acab7aaaa85d802bbbe50bb773a40154725cb8747da0946f694ecf07d35c2100aba16a25a0635648ce97a03c3acaa17a444c4e12369bcbe8bcf794dfb34b4d0fb45703b82c4ea3fd8abf20baa0314b3ed537dd2041b7e6fec124bd8374a74c8040d29ca6d38f706644ff70fda2cd2bd22d3d6f75869d4f51a1eaccf1b98ea7576b10050bad075ee6e4f6284ce90b1476b3d54471da0c5b943a9062aab5e88af3ed458c4ddcc64b32ed86c216a06da26f27e1ccae0169d91be70d54be97a37bd3d3d487875d50410c001462785b62e835926ec60c4efcc46adea5cabd59b660411ddd6ce4778094491981c0fa4aee0a407e55efd78ed157a3029c9099bbabd88e2db72f82b507b5a1b556b3dca0093c5b55610c397537f31861ecde3247743ba9dd37639966f6b171b436ca9fd672e93f3e1389af03d0deb3a3e8680350a1bb9577bb54f59a9ebb6cac18858f5cb66cf18102822adaf8e86b1339e747dc7e850ff343a8954b51b69e28128c8a75fdf38900fb62ab3176f2d1becd65571c486abdbd2995ac748468daa207196c224c50e24db82e2a31f03f539cfa52adc8750e4d1e654137922d6d4e7c576c5c681315b33baa2b0919b5d7b698cfa9d439623450f846f1fb8d16b21d3c202713301ea52a990e632875cc0f56dd814d680cad72ea3aa890c2772625a319626505f630002dc12605193c1151defb76642033b07cb9b9bde393cb453b19e7b8684fdf89b44bec535ac464237257f620ea7697f53cc000686a7aa2bf6eb060af962a852f19ba0b54989f49c9b3547b8b67cf9f71a0aacfd4f66f35f73cc707b47da10433795b45ad7dc97024e739fabf8010308c083e60fc7ce533249193a6177d898fb2870a03533cb438f1b029828ac61710468a5813ebc0418ae0b934ecbb277ec55f08a533fa94a33dce7e359d8ac55f88126db086efd09e7ff9c48d8cd178bc4e1b05ac88fec3657081ea75918420d32c76de12b953bb40266ae2968d91c94073f5b8cf246642e47f2be12119f0dd5723b03d956241f3dbdbb744712633086ca59ba9ea1846db47d500bc00807cff30c50e131f610b253be7b1106fb4c90fc0be0b5ad4325052cc9770202027c6add626247219ad1159d9aca331ff2f1f8557a26d6dfbdfc1e684f41252da56e9877bf3c29332f70abca1048240b644b574233c0d3dcd1e796a7854c3872cb01e7fdfec8d8cf9d0ad8d8bb55858786baab41622d6dbf9b6b008e64a85dd1ad28f7d5cda9da74f37ab07dcdaabe6e46fb4c46ab96fce29a5e47d4d6999d1f6b8f67848a0a4425b772c114e3ee4212e43fd18e30b95f1b80152d448d8a657d1a5c7e4f4829c8a2aaa238a45089f3c549cd2f212c05c19d122da2e892b07665cda16a4525736b5f43abd003238730fe0ee76f9cd87968c02bea0d3d21769e70b68b51240fbf79439887ea9cc57c3ce117e317e171d667cca8aab9e5ea731df36fb08f545daad20d5d080f38e8d04ec4c5ad1730b3fe15d63c2b0f1769873f2e3ba947f4ab3359076746f710384a086ce21b36805108c28fc23b74d933edf486f0c81818657db00c4da23722af61ed415e31085e0dfbad52287af1e6f3ebf9fdd755c8f62665290ad1865e309330553e4bd6085a27709223380000000000000000000000000000000000000000020000000d4d9d5b2ba21d63f0e6f9f4bb811397fceaf088722fd951b42b8a1642696724b'

// from existed create spore cluster transaction: https://pudge.explorer.nervos.org/transaction/0xdd169db0980631ab796a49b3223cd1422425ea0964245ceaa0ca1e409ee6ce31
const sporeClusterData = '0x270000000c0000001b0000000b000000434b424578706c6f72657208000000466f722054657374'

describe('Parse Spore cell data', () => {
  beforeAll(() => {
    globalThis.TextDecoder = TextDecoder as any
  })

  afterAll(() => {
    globalThis.TextDecoder = undefined as any
  })

  it('parse spore cell data', async () => {
    const result = parseSporeCellData(sporeCellData)

    expect(result.contentType).toBe('image/webp')
    expect(result.clusterId).toBe('0xd4d9d5b2ba21d63f0e6f9f4bb811397fceaf088722fd951b42b8a164269672')
  })

  it('parse spore cluster data', async () => {
    const result = parseSporeClusterData(sporeClusterData)

    expect(result.name).toBe('CKBExplorer')
    expect(result.description).toBe('For Tes')
  })
})
